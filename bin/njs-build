#!/usr/bin/env node

/**
 * Module dependencies.
 */

var build = require('../lib/build');
var fs = require('fs');
var write = fs.writeFileSync;
var path = require('path');
var resolve = path.resolve;

var Duo = require('duo');
var stylus = require('duo-stylus')();
var jade = require('duo-jade')();
var mkdir = require('mkdirp');

// Little hack to include `NODE_PATH=.`
// require('node-path')(module, [resolve('.')]);

/**
 * old
 */

// var builder = build.createBuilder();
// builder.build(function(err, res) {
//   if (err) return console.log(err);
//   write('public/app.js', res.require + res.js);
//   write('public/app.css', res.css);
// });

/**
 * dou.js
 */

mkdir('public');
var js = new Duo(process.cwd());
var css = new Duo(process.cwd() + '/lib/boot');
js
  .entry('lib/boot/boot.js')
  .use(jade)
  .run(function (err, res) {
    if (err) return console.log(err), process.exit(1);

    write('public/app.js', res);
  });

css
  .entry('index.styl')
  .use(stylus)
  .assets('../../public')
  .run(function (err, res) {
    if (err) return console.log(err), process.exit(1);

    write('public/app.css', res);
  });